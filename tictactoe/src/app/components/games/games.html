<div class="max-w-2xl mx-auto p-4">
  <h2 class="text-2xl font-bold text-slate-800 mb-6">Jugar partida</h2>

  <!-- Tabs -->
  <div class="flex space-x-1 bg-slate-100 p-1 rounded-xl mb-6">
    <button
      (click)="setActiveTab('games')"
      [class.bg-white]="activeTab === 'games'"
      [class.shadow-sm]="activeTab === 'games'"
      class="flex-1 py-2 rounded-lg text-sm font-medium transition-all duration-200"
      [class.text-blue-600]="activeTab === 'games'"
      [class.text-slate-600]="activeTab !== 'games'">
      Juegos iniciados
    </button>
    <button
      (click)="setActiveTab('requests')"
      [class.bg-white]="activeTab === 'requests'"
      [class.shadow-sm]="activeTab === 'requests'"
      class="flex-1 py-2 rounded-lg text-sm font-medium transition-all duration-200 relative"
      [class.text-blue-600]="activeTab === 'requests'"
      [class.text-slate-600]="activeTab !== 'requests'">
      Solicitudes de juego
      <span
        *ngIf="invitations.length > 0"
        class="absolute top-1 right-2 bg-amber-500 text-white text-xs w-4 h-4 flex items-center justify-center rounded-full">
        {{ invitations.length }}
      </span>
    </button>
    <button
      (click)="setActiveTab('invite')"
      [class.bg-white]="activeTab === 'invite'"
      [class.shadow-sm]="activeTab === 'invite'"
      class="flex-1 py-2 rounded-lg text-sm font-medium transition-all duration-200"
      [class.text-blue-600]="activeTab === 'invite'"
      [class.text-slate-600]="activeTab !== 'invite'">
      Invitar a jugar
    </button>
  </div>

  <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-6">
    <!-- Juegos iniciados -->
    <div *ngIf="activeTab === 'games'">
      <div *ngIf="gameMoveNotification" class="mb-4 p-3 bg-blue-50 text-blue-700 rounded-lg text-sm">
        {{ gameMoveNotification }}
      </div>
      <div *ngIf="message" class="mb-4 p-3 bg-green-50 text-green-600 rounded-lg text-sm">{{ message }}</div>
      <div *ngIf="error" class="mb-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm">{{ error }}</div>
      <div *ngIf="games.length === 0" class="text-center py-8 text-slate-500">
        No tienes partidas aún.
      </div>

      <!-- Juegos pendientes (tu turno) -->
      <div *ngIf="pendingGames.length > 0" class="mb-6">
        <h3 class="text-sm font-semibold text-slate-600 mb-3">Tu turno</h3>
        <ul class="space-y-3">
          <li
            *ngFor="let game of pendingGames"
            class="flex items-center justify-between p-3 bg-amber-50 border border-amber-100 rounded-xl">
            <div class="flex items-center space-x-3">
              <div
                class="w-10 h-10 bg-amber-100 text-amber-600 rounded-full flex items-center justify-center font-bold">
                {{ game.opponentUsername?.charAt(0)?.toUpperCase() || '?' }}
              </div>
              <div>
                <p class="font-medium text-slate-800">vs {{ game.opponentUsername }}</p>
                <p class="text-xs text-amber-600">Tú eres {{ game.mySymbol }} · Es tu turno</p>
              </div>
            </div>
            <a
              [routerLink]="['/home/games', game.id]"
              class="bg-amber-500 text-white px-3 py-1.5 rounded-lg text-sm hover:bg-amber-600 transition-colors">
              Jugar
            </a>
          </li>
        </ul>
      </div>

      <!-- Resto de partidas -->
      <div *ngIf="otherGames.length > 0">
        <h3 class="text-sm font-semibold text-slate-600 mb-3">
          {{ pendingGames.length > 0 ? 'Otras partidas' : 'Partidas' }}
        </h3>
        <ul class="space-y-3">
          <li
            *ngFor="let game of otherGames"
            class="flex items-center justify-between p-3 bg-slate-50 rounded-xl">
            <div class="flex items-center space-x-3">
              <div
                class="w-10 h-10 bg-emerald-100 text-emerald-600 rounded-full flex items-center justify-center font-bold">
                {{ game.opponentUsername?.charAt(0)?.toUpperCase() || '?' }}
              </div>
              <div>
                <p class="font-medium text-slate-800">vs {{ game.opponentUsername }}</p>
                <p class="text-xs text-slate-500">
                  {{ statusLabel(game.status) }} · Tú eres {{ game.mySymbol }}
                </p>
              </div>
            </div>
            <span
              *ngIf="game.status === 'ACTIVE'"
              class="text-xs text-slate-500">Esperando al rival</span>
            <a
              *ngIf="game.status === 'ACTIVE'"
              [routerLink]="['/home/games', game.id]"
              class="text-blue-600 text-sm hover:underline">Ver</a>
            <span
              *ngIf="game.status !== 'ACTIVE'"
              class="text-xs px-2 py-1 rounded-full bg-slate-100 text-slate-600">
              {{ statusLabel(game.status) }}
            </span>
          </li>
        </ul>
      </div>
    </div>

    <!-- Solicitudes de juego -->
    <div *ngIf="activeTab === 'requests'">
      <div *ngIf="invitations.length === 0" class="text-center py-8 text-slate-500">
        No tienes solicitudes de juego pendientes.
      </div>
      <ul class="space-y-4">
        <li
          *ngFor="let inv of invitations"
          class="flex items-center justify-between p-3 bg-slate-50 rounded-xl">
          <div class="flex items-center space-x-3">
            <div
              class="w-10 h-10 bg-amber-100 text-amber-600 rounded-full flex items-center justify-center font-bold">
              {{ inv.senderName?.charAt(0)?.toUpperCase() || '?' }}
            </div>
            <div>
              <p class="font-medium text-slate-800">{{ inv.senderName }}</p>
              <p class="text-xs text-slate-500">Te invita a jugar</p>
            </div>
          </div>
          <div class="flex space-x-2">
            <button
              (click)="acceptInvitation(inv.invitationId)"
              class="bg-emerald-600 text-white px-3 py-1.5 rounded-lg text-sm hover:bg-emerald-700 transition-colors">
              Aceptar
            </button>
            <button
              (click)="rejectInvitation(inv.invitationId)"
              class="bg-slate-200 text-slate-600 px-3 py-1.5 rounded-lg text-sm hover:bg-slate-300 transition-colors">
              Rechazar
            </button>
          </div>
        </li>
      </ul>
    </div>

    <!-- Invitar a jugar -->
    <div *ngIf="activeTab === 'invite'">
      <div class="max-w-sm mx-auto">
        <label class="block text-sm font-medium text-slate-700 mb-2">Nombre de usuario</label>
        <div class="flex space-x-2">
          <input
            [(ngModel)]="targetUsername"
            type="text"
            placeholder="Ej: usuario123"
            class="flex-1 px-4 py-2 rounded-xl border border-slate-200 focus:outline-none focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500 transition-all" />
          <button
            (click)="sendInvite()"
            [disabled]="!targetUsername"
            class="bg-blue-600 text-white px-4 py-2 rounded-xl hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
            Invitar
          </button>
        </div>
        <div *ngIf="message" class="mt-4 p-3 bg-green-50 text-green-600 rounded-lg text-sm text-center">
          {{ message }}
        </div>
        <div *ngIf="error" class="mt-4 p-3 bg-red-50 text-red-600 rounded-lg text-sm text-center">
          {{ error }}
        </div>
      </div>
    </div>
  </div>
</div>
